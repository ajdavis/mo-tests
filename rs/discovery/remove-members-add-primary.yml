#A. Removal of members and addition of primary:
#                Setup
#             - Servers:
#                    - serverA
#                    - serverB
#                    - serverC
#                    - serverD
#                    - serverE
#                 - Op: findOne
#                 - URI: mongodb://serverA_host:serverA_port/?replicaSet=rs
#                 - MOConfig actions: [
#                                        1. create RS with config { replicaSet name: rs, 
#                                                                             members: serverA, serverB, serverC },
#                    2. create server: serverD,
#                                         3. create server: serverE ]
#
#
#1. Description: Ensure that client detects changes in the replica set
#                    (test step) client with URI
#                    (mo step) stop serverA
#                    (mo step) add serverD to RS set
#                    (mo step) add serverE to RS set
#                    * Ensure that client reports serverB, serverC, serverD, serverE in topology
#                    * Ensure that client does not report serverA in topology


description: "Client detects changes in replica set"

type: "ReplicaSet"

initConfig: { id: "integration_tests",
              members: [
                         { server_id: "serverA" },
                         { server_id: "serverB" },
                         { server_id: "serverC" }                         
                        ]
             }

options: {}

phases: [
          {
            MOOperation: { method: "POST",
                           uri: "/servers/serverA",
                           payload: { action: "stop" }
                         }
          },

          {
            MOOperation:
                         { method: "POST",
                           uri: "/replica_sets/integration_tests/members",
                           payload: { server_id: "serverD" }
                         }
          },

          {
            MOOperation:
                         { method: "POST",
                           uri: "/replica_sets/integration_tests/members",
                           payload: { server_id: "serverE" }
                         }
          }
        ]

tests: [
         {
           state:
                  { members: [ "serverB", "serverC", "serverD", "serverE" ] }
         }
       ]
